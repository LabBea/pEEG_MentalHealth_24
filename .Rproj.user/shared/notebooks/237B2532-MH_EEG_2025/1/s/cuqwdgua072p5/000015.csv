"0","# Prep the Data"
"0","MH_stratification <- All_obs %>% dplyr::select(""Visit"", ""ParticipantID"", ""PHQ9"", ""GAD7"")"
"0",""
"0","# Add categories"
"0","MH_stratification <- MH_stratification %>% "
"0","  mutate(PHQ9_category = case_when("
"0","    PHQ9 <= 4 ~ ""Normal"","
"0","    PHQ9 >= 5 & PHQ9 <= 9 ~ ""Mild"","
"0","    PHQ9 >= 10 ~ ""Moderate/Severe"","
"0","    is.na(PHQ9) ~ ""Missing"")) %>% "
"0","  mutate(GAD7_category = case_when("
"0","    GAD7 <= 4 ~ ""Normal"","
"0","    GAD7 >= 5 & GAD7 <= 9 ~ ""Mild"","
"0","    GAD7 >= 10 ~ ""Moderate/Severe"","
"0","    is.na(GAD7) ~ ""Missing"")) %>%"
"0","  mutate(Visit = case_when(Visit == ""T1"" ~ ""<16"","
"0","                           Visit == ""SV"" ~ ""20"","
"0","                           Visit == ""T2"" ~ ""24-28"","
"0","                           Visit == ""T3"" ~ ""36"","
"0","                           Visit == ""PP"" ~ ""Postpartum""))"
"0",""
"0","# Compute proportions within each visit"
"0","plot_data <- MH_stratification %>%"
"0","  group_by(Visit, PHQ9_category) %>%"
"0","  summarise(n = n(), .groups = ""drop"") %>%"
"0","  group_by(Visit) %>%"
"0","  mutate(percent = n / sum(n))  # Calculate percent per visit"
"0",""
"0","# Plot"
"0","ggplot(plot_data, aes(x = Visit, y = percent, fill = PHQ9_category)) +"
"0","  geom_bar(stat = ""identity"", position = ""fill"", alpha = 0.8) +  "
"0","  geom_text(aes(label = scales::percent(percent, accuracy = 1)), "
"0","            position = position_fill(vjust = 0.5), "
"0","            size = 3, color = ""black"") +  # Adjust text size & color"
"0","  labs(x = ""Gestational Weeks"", y = ""Proportion"", fill = ""PHQ-9 Category"") +"
"0","  theme_classic() +"
"0","  scale_fill_manual(values = c(""Normal"" = ""dodgerblue2"", ""Mild"" = ""mediumpurple"", "
"0","                               ""Moderate/Severe"" = ""darkorange2"", ""Missing"" = ""grey"")) +"
"0","  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +  # Format y-axis as percentage"
"0","  theme(axis.text.x = element_text(size = 14, color = ""black""),"
"0","        axis.text.y = element_text(size = 14, color = ""black""),"
"0","        axis.title.x = element_text(size = 16, color = ""black""),"
"0","        axis.title.y = element_text(size = 16, color = ""black""),"
"0","        legend.title = element_text(size = 14),"
"0","        legend.text = element_text(size = 12))  +"
"0","  scale_x_discrete(limits = c(""<16"", ""20"",""24-28"", ""36"", ""Postpartum""))  "
